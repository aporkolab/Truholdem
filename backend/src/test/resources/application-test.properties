# ==============================================================================
# TruHoldem Test Configuration
# ==============================================================================
# This configuration is designed for fast unit and integration tests using
# H2 in-memory database in PostgreSQL compatibility mode.
#
# Profile: test
# Usage: @ActiveProfiles("test") or spring.profiles.active=test
# ==============================================================================

# ==============================================================================
# DATABASE CONFIGURATION - H2 in PostgreSQL Mode
# ==============================================================================
# Using H2 for fast test execution while maintaining PostgreSQL compatibility.
# DB_CLOSE_DELAY=-1 keeps the database alive until JVM shutdown.
# MODE=PostgreSQL enables PostgreSQL-specific SQL syntax support.
# DATABASE_TO_LOWER=TRUE matches PostgreSQL's default case handling.

spring.datasource.url=jdbc:h2:mem:truholdem_test;DB_CLOSE_DELAY=-1;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# JPA/Hibernate settings optimized for test speed
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.generate_statistics=false

# Disable Liquibase - we use Hibernate's ddl-auto for test schema
spring.liquibase.enabled=false

# ==============================================================================
# SECURITY CONFIGURATION - JWT for Tests
# ==============================================================================
# These values are for testing ONLY - never use in production!

app.jwt.secret=testSecretKeyForTesting_AtLeast32Chars_LongEnough_ForHS256!!
app.jwt.expiration=3600000
app.jwt.refresh-expiration=7200000

# Simplified JWT config aliases (for backward compatibility)
app.jwt.refreshExpiration=7200000

# ==============================================================================
# GAME CONFIGURATION - Default Values for Tests
# ==============================================================================
# Standard poker table configuration matching TestConstants values

app.game.default-chips=1000
app.game.default-small-blind=10
app.game.default-big-blind=20
app.game.max-players=10
app.game.min-players=2
app.game.bot-think-time=100
app.game.botThinkTime=100

# ==============================================================================
# EXTERNAL DEPENDENCIES - Disabled for Unit Tests
# ==============================================================================
# Redis and WebSocket are disabled to enable fast, isolated unit tests.
# Integration tests use Testcontainers for real Redis/PostgreSQL instances.

# Disable Redis auto-configuration
spring.data.redis.repositories.enabled=false
spring.cache.type=none

# Exclude configurations that require external services
spring.autoconfigure.exclude=\
  org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\
  org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\
  org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration,\
  io.opentelemetry.instrumentation.spring.autoconfigure.OpenTelemetryAutoConfiguration

# Disable OpenTelemetry in tests
otel.enabled=false

# ==============================================================================
# CORS CONFIGURATION - Permissive for Tests
# ==============================================================================

app.cors.allowed-origins=http://localhost:4200
app.cors.allowedOrigins=*
app.cors.allowedMethods=GET,POST,PUT,DELETE,PATCH,OPTIONS
app.cors.allowedHeaders=*

# ==============================================================================
# WEBSOCKET CONFIGURATION - Disabled for Unit Tests
# ==============================================================================

app.websocket.enabled=false
app.websocket.allowedOrigins=*

# ==============================================================================
# RATE LIMITING - Disabled for Tests
# ==============================================================================
# Rate limiting would interfere with rapid test execution

rate-limit.enabled=false

# ==============================================================================
# LOGGING CONFIGURATION - Minimal for Fast Tests
# ==============================================================================
# Keep logging minimal to speed up test execution.
# Increase specific logger levels when debugging test failures.

logging.level.root=WARN
logging.level.com.truholdem=INFO
logging.level.org.springframework=WARN
logging.level.org.hibernate=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# Testcontainers logging
logging.level.org.testcontainers=WARN
logging.level.com.github.dockerjava=WARN
logging.level.tc=WARN

# ==============================================================================
# ACTUATOR CONFIGURATION - Minimal for Tests
# ==============================================================================

management.endpoints.enabled-by-default=false
management.endpoint.health.enabled=true

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================
# Random port to avoid conflicts when running tests in parallel

server.port=0

# ==============================================================================
# AUTHORIZATION CONFIGURATION - Disabled for Tests
# ==============================================================================
# Game authorization is disabled for integration tests to allow testing
# without setting up complex user-player relationships
app.security.authorization.enabled=false

# ==============================================================================
# ADDITIONAL TEST OPTIMIZATIONS
# ==============================================================================

# Disable banner for cleaner test output
spring.main.banner-mode=off

# Allow bean definition overriding for test configurations
spring.main.allow-bean-definition-overriding=true

# Lazy initialization for faster context startup (use with caution)
# spring.main.lazy-initialization=true

# Disable unnecessary features
spring.jmx.enabled=false
